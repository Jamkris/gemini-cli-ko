# Gemini CLIì˜ MCP ì„œë²„

ì´ ë¬¸ì„œëŠ” Gemini CLIì—ì„œ Model Context Protocol(MCP) ì„œë²„ë¥¼ êµ¬ì„±í•˜ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## MCP ì„œë²„ë€ ë¬´ì—‡ì¸ê°€ìš”?

MCP ì„œë²„ëŠ” Model Context Protocolì„ í†µí•´ Gemini CLIì— ë„êµ¬ì™€ ë¦¬ì†ŒìŠ¤ë¥¼ ë…¸ì¶œí•˜ì—¬ ì™¸ë¶€ ì‹œìŠ¤í…œ ë° ë°ì´í„° ì†ŒìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. MCP ì„œë²„ëŠ” Gemini ëª¨ë¸ê³¼ ë¡œì»¬ í™˜ê²½ ë˜ëŠ” APIì™€ ê°™ì€ ê¸°íƒ€ ì„œë¹„ìŠ¤ ì‚¬ì´ì˜ ë‹¤ë¦¬ ì—­í• ì„ í•©ë‹ˆë‹¤.

MCP ì„œë²„ë¥¼ í†µí•´ Gemini CLIëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **ë„êµ¬ ë°œê²¬:** í‘œì¤€í™”ëœ ìŠ¤í‚¤ë§ˆ ì •ì˜ë¥¼ í†µí•´ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬, ì„¤ëª… ë° ë§¤ê°œë³€ìˆ˜ë¥¼ ë‚˜ì—´í•©ë‹ˆë‹¤.
- **ë„êµ¬ ì‹¤í–‰:** ì •ì˜ëœ ì¸ìë¡œ íŠ¹ì • ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ê³  êµ¬ì¡°í™”ëœ ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.
- **ë¦¬ì†ŒìŠ¤ ì•¡ì„¸ìŠ¤:** ì„œë²„ê°€ ë…¸ì¶œí•˜ëŠ” íŠ¹ì • ë¦¬ì†ŒìŠ¤(íŒŒì¼, API í˜ì´ë¡œë“œ, ë³´ê³ ì„œ ë“±)ì—ì„œ ë°ì´í„°ë¥¼ ì½ìŠµë‹ˆë‹¤.

MCP ì„œë²„ë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤, API, ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ì „ë¬¸í™”ëœ ì›Œí¬í”Œë¡œì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë“± ê¸°ë³¸ ê¸°ëŠ¥ì„ ë„˜ì–´ Gemini CLIì˜ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## í•µì‹¬ í†µí•© ì•„í‚¤í…ì²˜

Gemini CLIëŠ” í•µì‹¬ íŒ¨í‚¤ì§€(`packages/core/src/tools/`)ì— ë‚´ì¥ëœ ì •êµí•œ ë°œê²¬ ë° ì‹¤í–‰ ì‹œìŠ¤í…œì„ í†µí•´ MCP ì„œë²„ì™€ í†µí•©ë©ë‹ˆë‹¤:

### ë°œê²¬ ê³„ì¸µ (`mcp-client.ts`)

ë°œê²¬ í”„ë¡œì„¸ìŠ¤ëŠ” `discoverMcpTools()`ì— ì˜í•´ ì¡°ì •ë˜ë©°, ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. **êµ¬ì„±ëœ ì„œë²„ ë°˜ë³µ:** `settings.json`ì˜ `mcpServers` êµ¬ì„±ì—ì„œ ì„œë²„ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤.
2. **ì—°ê²° ìˆ˜ë¦½:** ì ì ˆí•œ ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜(Stdio, SSE ë˜ëŠ” Streamable HTTP)ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê²°ì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.
3. **ë„êµ¬ ì •ì˜ ê°€ì ¸ì˜¤ê¸°:** MCP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ê° ì„œë²„ì—ì„œ ë„êµ¬ ì •ì˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
4. **ìœ„ìƒ ì²˜ë¦¬ ë° ìœ íš¨ì„± ê²€ì‚¬:** Gemini APIì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ë„êµ¬ ìŠ¤í‚¤ë§ˆë¥¼ ìœ„ìƒ ì²˜ë¦¬í•˜ê³  ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
5. **ë„êµ¬ ë“±ë¡:** ì¶©ëŒ í•´ê²°ê³¼ í•¨ê»˜ ì „ì—­ ë„êµ¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë„êµ¬ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
6. **ë¦¬ì†ŒìŠ¤ ê°€ì ¸ì˜¤ê¸° ë° ë“±ë¡:** ì„œë²„ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” ê²½ìš° ì´ë¥¼ ê°€ì ¸ì™€ ë“±ë¡í•©ë‹ˆë‹¤.

### ì‹¤í–‰ ê³„ì¸µ (`mcp-tool.ts`)

ë°œê²¬ëœ ê° MCP ë„êµ¬ëŠ” `DiscoveredMCPTool` ì¸ìŠ¤í„´ìŠ¤ë¡œ ë˜í•‘ë˜ë©°, ì´ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- **í™•ì¸ ë¡œì§ ì²˜ë¦¬:** ì„œë²„ ì‹ ë¢° ì„¤ì • ë° ì‚¬ìš©ì ê¸°ë³¸ ì„¤ì •ì— ë”°ë¼ í™•ì¸ ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **ë„êµ¬ ì‹¤í–‰ ê´€ë¦¬:** ì ì ˆí•œ ë§¤ê°œë³€ìˆ˜ë¡œ MCP ì„œë²„ë¥¼ í˜¸ì¶œí•˜ì—¬ ë„êµ¬ ì‹¤í–‰ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- **ì‘ë‹µ ì²˜ë¦¬:** LLM ì»¨í…ìŠ¤íŠ¸ ë° ì‚¬ìš©ì í‘œì‹œë¥¼ ìœ„í•´ ì‘ë‹µì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **ì—°ê²° ìƒíƒœ ìœ ì§€:** ì—°ê²° ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  íƒ€ì„ì•„ì›ƒì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

### ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜

Gemini CLIëŠ” ì„¸ ê°€ì§€ MCP ì „ì†¡ ìœ í˜•ì„ ì§€ì›í•©ë‹ˆë‹¤:

- **Stdio ì „ì†¡:** í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ê³  stdin/stdoutì„ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤.
- **SSE ì „ì†¡:** Server-Sent Events ì—”ë“œí¬ì¸íŠ¸ì— ì—°ê²°í•©ë‹ˆë‹¤.
- **Streamable HTTP ì „ì†¡:** í†µì‹ ì— HTTP ìŠ¤íŠ¸ë¦¬ë°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

## MCP ë¦¬ì†ŒìŠ¤ ì‘ì—…

ì¼ë¶€ MCP ì„œë²„ëŠ” ë„êµ¬ ë° í”„ë¡¬í”„íŠ¸ ì™¸ì—ë„ ì»¨í…ìŠ¤íŠ¸ "ë¦¬ì†ŒìŠ¤"ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤. Gemini CLIëŠ” ì´ë¥¼ ìë™ìœ¼ë¡œ ë°œê²¬í•˜ê³  ì±„íŒ…ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ë°œê²¬ ë° ë‚˜ì—´

- ë°œê²¬ì´ ì‹¤í–‰ë˜ë©´ CLIëŠ” ê° ì„œë²„ì˜ `resources/list` ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
- `/mcp` ëª…ë ¹ì€ ëª¨ë“  ì—°ê²°ëœ ì„œë²„ì— ëŒ€í•´ ë„êµ¬ ë° í”„ë¡¬í”„íŠ¸ì™€ í•¨ê»˜ ë¦¬ì†ŒìŠ¤ ì„¹ì…˜ì„ í‘œì‹œí•©ë‹ˆë‹¤.

ì´ëŠ” URIì™€ ë©”íƒ€ë°ì´í„°ì˜ ê°„ê²°í•œ ì¼ë°˜ í…ìŠ¤íŠ¸ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

### ëŒ€í™”ì—ì„œ ë¦¬ì†ŒìŠ¤ ì°¸ì¡°í•˜ê¸°

ë¡œì»¬ íŒŒì¼ì„ ì°¸ì¡°í•  ë•Œ ì´ë¯¸ ì•Œë ¤ì§„ `@` êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
@server://resource/path
```

ë¦¬ì†ŒìŠ¤ URIëŠ” íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œì™€ í•¨ê»˜ ì™„ì„± ë©”ë‰´ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ë©”ì‹œì§€ë¥¼ ì œì¶œí•˜ë©´ CLIê°€ `resources/read`ë¥¼ í˜¸ì¶œí•˜ê³  ë‚´ìš©ì„ ëŒ€í™”ì— ì£¼ì…í•©ë‹ˆë‹¤.

## MCP ì„œë²„ ì„¤ì • ë°©ë²•

Gemini CLIëŠ” `settings.json` íŒŒì¼ì˜ `mcpServers` êµ¬ì„±ì„ ì‚¬ìš©í•˜ì—¬ MCP ì„œë²„ë¥¼ ì°¾ê³  ì—°ê²°í•©ë‹ˆë‹¤. ì´ êµ¬ì„±ì€ ë‹¤ì–‘í•œ ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜ì„ ê°€ì§„ ì—¬ëŸ¬ ì„œë²„ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

### settings.jsonì—ì„œ MCP ì„œë²„ êµ¬ì„±

`settings.json` íŒŒì¼ì—ì„œ MCP ì„œë²„ë¥¼ êµ¬ì„±í•˜ëŠ” ë‘ ê°€ì§€ ì£¼ìš” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤: êµ¬ì²´ì ì¸ ì„œë²„ ì •ì˜ë¥¼ ìœ„í•œ ìµœìƒìœ„ `mcpServers` ê°ì²´ì™€ ì„œë²„ ë°œê²¬ ë° ì‹¤í–‰ì„ ì œì–´í•˜ëŠ” ì „ì—­ ì„¤ì •ì„ ìœ„í•œ `mcp` ê°ì²´ë¥¼ í†µí•´ì„œì…ë‹ˆë‹¤.

#### ì „ì—­ MCP ì„¤ì • (`mcp`)

`settings.json`ì˜ `mcp` ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  MCP ì„œë²„ì— ëŒ€í•œ ì „ì—­ ê·œì¹™ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **`mcp.serverCommand`** (ë¬¸ìì—´): MCP ì„œë²„ë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•œ ì „ì—­ ëª…ë ¹ì…ë‹ˆë‹¤.
- **`mcp.allowed`** (ë¬¸ìì—´ ë°°ì—´): í—ˆìš©í•  MCP ì„œë²„ ì´ë¦„ ëª©ë¡ì…ë‹ˆë‹¤. ì´ê²ƒì´ ì„¤ì •ë˜ë©´ ì´ ëª©ë¡ì— ìˆëŠ” ì„œë²„(`mcpServers` ê°ì²´ì˜ í‚¤ì™€ ì¼ì¹˜)ë§Œ ì—°ê²°ë©ë‹ˆë‹¤.
- **`mcp.excluded`** (ë¬¸ìì—´ ë°°ì—´): ì œì™¸í•  MCP ì„œë²„ ì´ë¦„ ëª©ë¡ì…ë‹ˆë‹¤. ì´ ëª©ë¡ì— ìˆëŠ” ì„œë²„ì—ëŠ” ì—°ê²°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì˜ˆ:**

```json
{
  "mcp": {
    "allowed": ["my-trusted-server"],
    "excluded": ["experimental-server"]
  }
}
```

#### ì„œë²„ë³„ êµ¬ì„± (`mcpServers`)

`mcpServers` ê°ì²´ëŠ” CLIê°€ ì—°ê²°í•  ê° ê°œë³„ MCP ì„œë²„ë¥¼ ì •ì˜í•˜ëŠ” ê³³ì…ë‹ˆë‹¤.

### êµ¬ì„± êµ¬ì¡°

`settings.json` íŒŒì¼ì— `mcpServers` ê°ì²´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”:

```json
{ ...file contains other config objects
  "mcpServers": {
    "serverName": {
      "command": "path/to/server",
      "args": ["--arg1", "value1"],
      "env": {
        "API_KEY": "$MY_API_TOKEN"
      },
      "cwd": "./server-directory",
      "timeout": 30000,
      "trust": false
    }
  }
}
```

### êµ¬ì„± ì†ì„±

ê° ì„œë²„ êµ¬ì„±ì€ ë‹¤ìŒ ì†ì„±ì„ ì§€ì›í•©ë‹ˆë‹¤:

#### í•„ìˆ˜ (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)

- **`command`** (ë¬¸ìì—´): Stdio ì „ì†¡ì„ ìœ„í•œ ì‹¤í–‰ íŒŒì¼ ê²½ë¡œ
- **`url`** (ë¬¸ìì—´): SSE ì—”ë“œí¬ì¸íŠ¸ URL (ì˜ˆ: `"http://localhost:8080/sse"`)
- **`httpUrl`** (ë¬¸ìì—´): HTTP ìŠ¤íŠ¸ë¦¬ë° ì—”ë“œí¬ì¸íŠ¸ URL

#### ì„ íƒ ì‚¬í•­

- **`args`** (ë¬¸ìì—´[]): Stdio ì „ì†¡ì„ ìœ„í•œ ëª…ë ¹ì¤„ ì¸ìˆ˜
- **`headers`** (ê°ì²´): `url` ë˜ëŠ” `httpUrl` ì‚¬ìš© ì‹œ ì‚¬ìš©ì ì§€ì • HTTP í—¤ë”
- **`env`** (ê°ì²´): ì„œë²„ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ í™˜ê²½ ë³€ìˆ˜. ê°’ì€ `$VAR_NAME` ë˜ëŠ” `${VAR_NAME}` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`cwd`** (ë¬¸ìì—´): Stdio ì „ì†¡ì„ ìœ„í•œ ì‘ì—… ë””ë ‰í„°ë¦¬
- **`timeout`** (ìˆ«ì): ìš”ì²­ íƒ€ì„ì•„ì›ƒ(ë°€ë¦¬ì´ˆ) (ê¸°ë³¸ê°’: 600,000ms = 10ë¶„)
- **`trust`** (ë¶€ìš¸): `true`ì¼ ê²½ìš°, ì´ ì„œë²„ì— ëŒ€í•œ ëª¨ë“  ë„êµ¬ í˜¸ì¶œ í™•ì¸ì„ ê±´ë„ˆëœë‹ˆë‹¤ (ê¸°ë³¸ê°’: `false`).
- **`includeTools`** (ë¬¸ìì—´[]): ì´ MCP ì„œë²„ì—ì„œ í¬í•¨í•  ë„êµ¬ ì´ë¦„ ëª©ë¡ì…ë‹ˆë‹¤. ì§€ì •í•˜ë©´ ì´ ì„œë²„ì—ì„œëŠ” ì—¬ê¸°ì— ë‚˜ì—´ëœ ë„êµ¬ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(í—ˆìš© ëª©ë¡ ë™ì‘). ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì„œë²„ì˜ ëª¨ë“  ë„êµ¬ê°€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤.
- **`excludeTools`** (ë¬¸ìì—´[]): ì´ MCP ì„œë²„ì—ì„œ ì œì™¸í•  ë„êµ¬ ì´ë¦„ ëª©ë¡ì…ë‹ˆë‹¤. ì—¬ê¸°ì— ë‚˜ì—´ëœ ë„êµ¬ëŠ” ì„œë²„ì—ì„œ ë…¸ì¶œí•˜ë”ë¼ë„ ëª¨ë¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. **ì°¸ê³ :** `excludeTools`ëŠ” `includeTools`ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŠµë‹ˆë‹¤. ë„êµ¬ê°€ ë‘ ëª©ë¡ì— ëª¨ë‘ ìˆìœ¼ë©´ ì œì™¸ë©ë‹ˆë‹¤.
- **`targetAudience`** (ë¬¸ìì—´): ì•¡ì„¸ìŠ¤í•˜ë ¤ëŠ” IAP ë³´í˜¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í—ˆìš©ëœ OAuth í´ë¼ì´ì–¸íŠ¸ IDì…ë‹ˆë‹¤. `authProviderType: 'service_account_impersonation'`ê³¼ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **`targetServiceAccount`** (ë¬¸ìì—´): ê°€ì¥í•  Google Cloud ì„œë¹„ìŠ¤ ê³„ì •ì˜ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤. `authProviderType: 'service_account_impersonation'`ê³¼ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤.

### ì›ê²© MCP ì„œë²„ì— ëŒ€í•œ OAuth ì§€ì›

Gemini CLIëŠ” SSE ë˜ëŠ” HTTP ì „ì†¡ì„ ì‚¬ìš©í•˜ëŠ” ì›ê²© MCP ì„œë²„ì— ëŒ€í•œ OAuth 2.0 ì¸ì¦ì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì¸ì¦ì´ í•„ìš”í•œ MCP ì„œë²„ì— ì•ˆì „í•˜ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ìë™ OAuth ë°œê²¬

OAuth ë°œê²¬ì„ ì§€ì›í•˜ëŠ” ì„œë²„ì˜ ê²½ìš°, OAuth êµ¬ì„±ì„ ìƒëµí•˜ê³  CLIê°€ ìë™ìœ¼ë¡œ ë°œê²¬í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "mcpServers": {
    "discoveredServer": {
      "url": "https://api.example.com/sse"
    }
  }
}
```

CLIëŠ” ìë™ìœ¼ë¡œ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

- ì„œë²„ê°€ OAuth ì¸ì¦ì„ ìš”êµ¬í•  ë•Œ ê°ì§€ (401 ì‘ë‹µ)
- ì„œë²„ ë©”íƒ€ë°ì´í„°ì—ì„œ OAuth ì—”ë“œí¬ì¸íŠ¸ ë°œê²¬
- ì§€ì›ë˜ëŠ” ê²½ìš° ë™ì  í´ë¼ì´ì–¸íŠ¸ ë“±ë¡ ìˆ˜í–‰
- OAuth íë¦„ ë° í† í° ê´€ë¦¬ ì²˜ë¦¬

#### ì¸ì¦ íë¦„

OAuth ì§€ì› ì„œë²„ì— ì—°ê²°í•  ë•Œ:

1. **ì´ˆê¸° ì—°ê²° ì‹œë„**ê°€ 401 Unauthorizedë¡œ ì‹¤íŒ¨
2. **OAuth ë°œê²¬**ì´ ê¶Œí•œ ë¶€ì—¬ ë° í† í° ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ìŒ
3. ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•´ **ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¼** (ë¡œì»¬ ë¸Œë¼ìš°ì € ì•¡ì„¸ìŠ¤ í•„ìš”)
4. **ì¸ì¦ ì½”ë“œ**ê°€ ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ êµí™˜ë¨
5. **í† í°ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë¨** (ë¯¸ë˜ ì‚¬ìš©ì„ ìœ„í•´)
6. ìœ íš¨í•œ í† í°ìœ¼ë¡œ **ì—°ê²° ì¬ì‹œë„** ì„±ê³µ

#### ë¸Œë¼ìš°ì € ë¦¬ë””ë ‰ì…˜ ìš”êµ¬ ì‚¬í•­

**ì¤‘ìš”:** OAuth ì¸ì¦ì„ ìœ„í•´ì„œëŠ” ë¡œì»¬ ë¨¸ì‹ ì´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

- ì¸ì¦ì„ ìœ„í•œ ì›¹ ë¸Œë¼ìš°ì € ì—´ê¸°
- `http://localhost:7777/oauth/callback`ì—ì„œ ë¦¬ë””ë ‰ì…˜ ìˆ˜ì‹ 

ì´ ê¸°ëŠ¥ì€ ë‹¤ìŒ í™˜ê²½ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

- ë¸Œë¼ìš°ì € ì•¡ì„¸ìŠ¤ê°€ ì—†ëŠ” í—¤ë“œë¦¬ìŠ¤ í™˜ê²½
- X11 í¬ì›Œë”© ì—†ëŠ” ì›ê²© SSH ì„¸ì…˜
- ë¸Œë¼ìš°ì € ì§€ì›ì´ ì—†ëŠ” ì»¨í…Œì´ë„ˆí™”ëœ í™˜ê²½

#### OAuth ì¸ì¦ ê´€ë¦¬

`/mcp auth` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ OAuth ì¸ì¦ì„ ê´€ë¦¬í•˜ì„¸ìš”:

```bash
# ì¸ì¦ì´ í•„ìš”í•œ ì„œë²„ ë‚˜ì—´
/mcp auth

# íŠ¹ì • ì„œë²„ë¡œ ì¸ì¦
/mcp auth serverName

# í† í°ì´ ë§Œë£Œëœ ê²½ìš° ì¬ì¸ì¦
/mcp auth serverName
```

#### OAuth êµ¬ì„± ì†ì„±

- **`enabled`** (ë¶€ìš¸): ì´ ì„œë²„ì— ëŒ€í•´ OAuth í™œì„±í™”
- **`clientId`** (ë¬¸ìì—´): OAuth í´ë¼ì´ì–¸íŠ¸ ì‹ë³„ì (ë™ì  ë“±ë¡ ì‹œ ì„ íƒ ì‚¬í•­)
- **`clientSecret`** (ë¬¸ìì—´): OAuth í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ (ê³µìš© í´ë¼ì´ì–¸íŠ¸ì˜ ê²½ìš° ì„ íƒ ì‚¬í•­)
- **`authorizationUrl`** (ë¬¸ìì—´): OAuth ê¶Œí•œ ë¶€ì—¬ ì—”ë“œí¬ì¸íŠ¸ (ìƒëµ ì‹œ ìë™ ë°œê²¬)
- **`tokenUrl`** (ë¬¸ìì—´): OAuth í† í° ì—”ë“œí¬ì¸íŠ¸ (ìƒëµ ì‹œ ìë™ ë°œê²¬)
- **`scopes`** (ë¬¸ìì—´[]): í•„ìˆ˜ OAuth ë²”ìœ„
- **`redirectUri`** (ë¬¸ìì—´): ì‚¬ìš©ì ì§€ì • ë¦¬ë””ë ‰ì…˜ URI (ê¸°ë³¸ê°’ `http://localhost:7777/oauth/callback`)
- **`tokenParamName`** (ë¬¸ìì—´): SSE URLì˜ í† í° ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ ì´ë¦„
- **`audiences`** (ë¬¸ìì—´[]): í† í°ì´ ìœ íš¨í•œ ëŒ€ìƒ

#### í† í° ê´€ë¦¬

OAuth í† í°ì€ ìë™ìœ¼ë¡œ:

- `~/.gemini/mcp-oauth-tokens.json`ì— **ì•ˆì „í•˜ê²Œ ì €ì¥**ë©ë‹ˆë‹¤.
- ë§Œë£Œ ì‹œ **ìƒˆë¡œ ê³ ì¹¨**ë©ë‹ˆë‹¤ (ìƒˆë¡œ ê³ ì¹¨ í† í°ì´ ìˆëŠ” ê²½ìš°).
- ê° ì—°ê²° ì‹œë„ ì „ì— **ìœ íš¨ì„± ê²€ì‚¬**ë©ë‹ˆë‹¤.
- ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ê²½ìš° **ì •ë¦¬**ë©ë‹ˆë‹¤.

#### ì¸ì¦ ê³µê¸‰ì ìœ í˜•

`authProviderType` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ê³µê¸‰ì ìœ í˜•ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **`authProviderType`** (ë¬¸ìì—´): ì¸ì¦ ê³µê¸‰ìë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
  - **`dynamic_discovery`** (ê¸°ë³¸ê°’): CLIê°€ ì„œë²„ì—ì„œ OAuth êµ¬ì„±ì„ ìë™ìœ¼ë¡œ ë°œê²¬í•©ë‹ˆë‹¤.
  - **`google_credentials`**: CLIê°€ Google ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ ìê²© ì¦ëª…(ADC)ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ì¸ì¦í•©ë‹ˆë‹¤. ì´ ê³µê¸‰ìë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” í•„ìˆ˜ ë²”ìœ„ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
  - **`service_account_impersonation`**: CLIê°€ Google Cloud ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥í•˜ì—¬ ì„œë²„ì— ì¸ì¦í•©ë‹ˆë‹¤. IAPë¡œ ë³´í˜¸ë˜ëŠ” ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤(Cloud Run ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ íŠ¹ë³„íˆ ì„¤ê³„ë¨).

#### Google ìê²© ì¦ëª…

```json
{
  "mcpServers": {
    "googleCloudServer": {
      "httpUrl": "https://my-gcp-service.run.app/mcp",
      "authProviderType": "google_credentials",
      "oauth": {
        "scopes": ["https://www.googleapis.com/auth/userinfo.email"]
      }
    }
  }
}
```

#### ì„œë¹„ìŠ¤ ê³„ì • ê°€ì¥(Impersonation)

ì„œë¹„ìŠ¤ ê³„ì • ê°€ì¥ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ì¸ì¦í•˜ë ¤ë©´ `authProviderType`ì„ `service_account_impersonation`ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë‹¤ìŒ ì†ì„±ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤:

- **`targetAudience`** (ë¬¸ìì—´): ì•¡ì„¸ìŠ¤í•˜ë ¤ëŠ” IAP ë³´í˜¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í—ˆìš©ëœ OAuth í´ë¼ì´ì–¸íŠ¸ IDì…ë‹ˆë‹¤.
- **`targetServiceAccount`** (ë¬¸ìì—´): ê°€ì¥í•  Google Cloud ì„œë¹„ìŠ¤ ê³„ì •ì˜ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.

CLIëŠ” ë¡œì»¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ ìê²© ì¦ëª…(ADC)ì„ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ì„œë¹„ìŠ¤ ê³„ì • ë° ëŒ€ìƒì— ëŒ€í•œ OIDC ID í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ì´ í† í°ì„ ì‚¬ìš©í•˜ì—¬ MCP ì„œë²„ì— ì¸ì¦í•©ë‹ˆë‹¤.

#### ì„¤ì • ì§€ì¹¨

1. **OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ IDë¥¼ [ìƒì„±](https://cloud.google.com/iap/docs/oauth-client-creation)í•˜ê±°ë‚˜ ê¸°ì¡´ IDë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.** ê¸°ì¡´ OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ [OAuth í´ë¼ì´ì–¸íŠ¸ ê³µìœ  ë°©ë²•](https://cloud.google.com/iap/docs/sharing-oauth-clients)ì˜ ë‹¨ê³„ë¥¼ ë”°ë¥´ì„¸ìš”.
2. **ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ [í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤](https://cloud.google.com/iap/docs/sharing-oauth-clients#programmatic_access)ë¥¼ ìœ„í•´ í—ˆìš© ëª©ë¡ì— OAuth IDë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.** Cloud Runì€ ì•„ì§ gcloud iapì—ì„œ ì§€ì›ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ìœ í˜•ì´ ì•„ë‹ˆë¯€ë¡œ í”„ë¡œì íŠ¸ì—ì„œ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ í—ˆìš© ëª©ë¡ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
3. **ì„œë¹„ìŠ¤ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.** [ë¬¸ì„œ](https://cloud.google.com/iam/docs/service-accounts-create#creating), [Cloud Console ë§í¬](https://console.cloud.google.com/iam-admin/serviceaccounts)
4. Cloud Run ì„œë¹„ìŠ¤ ìì²´ì˜ "ë³´ì•ˆ(Security)" íƒ­ ë˜ëŠ” gcloudë¥¼ í†µí•´ **IAP ì •ì±…ì— ì„œë¹„ìŠ¤ ê³„ì •ê³¼ ì‚¬ìš©ìë¥¼ ëª¨ë‘ ì¶”ê°€í•©ë‹ˆë‹¤.**
5. MCP ì„œë²„ì— ì•¡ì„¸ìŠ¤í•  **ëª¨ë“  ì‚¬ìš©ì ë° ê·¸ë£¹ì—ê²Œ** [ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥](https://cloud.google.com/docs/authentication/use-service-account-impersonation)í•˜ëŠ” ë° í•„ìš”í•œ ê¶Œí•œ(ì¦‰, `roles/iam.serviceAccountTokenCreator`)ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
6. í”„ë¡œì íŠ¸ì— ëŒ€í•´ **IAM Credentials APIë¥¼ [í™œì„±í™”](https://console.cloud.google.com/apis/library/iamcredentials.googleapis.com)í•©ë‹ˆë‹¤.**

### êµ¬ì„± ì˜ˆì‹œ

#### Python MCP ì„œë²„ (stdio)

```json
{
  "mcpServers": {
    "pythonTools": {
      "command": "python",
      "args": ["-m", "my_mcp_server", "--port", "8080"],
      "cwd": "./mcp-servers/python",
      "env": {
        "DATABASE_URL": "$DB_CONNECTION_STRING",
        "API_KEY": "${EXTERNAL_API_KEY}"
      },
      "timeout": 15000
    }
  }
}
```

#### Node.js MCP ì„œë²„ (stdio)

```json
{
  "mcpServers": {
    "nodeServer": {
      "command": "node",
      "args": ["dist/server.js", "--verbose"],
      "cwd": "./mcp-servers/node",
      "trust": true
    }
  }
}
```

#### Docker ê¸°ë°˜ MCP ì„œë²„

```json
{
  "mcpServers": {
    "dockerizedServer": {
      "command": "docker",
      "args": [
        "run",
        "-i",
        "--rm",
        "-e",
        "API_KEY",
        "-v",
        "${PWD}:/workspace",
        "my-mcp-server:latest"
      ],
      "env": {
        "API_KEY": "$EXTERNAL_SERVICE_TOKEN"
      }
    }
  }
}
```

#### HTTP ê¸°ë°˜ MCP ì„œë²„

```json
{
  "mcpServers": {
    "httpServer": {
      "httpUrl": "http://localhost:3000/mcp",
      "timeout": 5000
    }
  }
}
```

#### ì‚¬ìš©ì ì§€ì • í—¤ë”ê°€ ìˆëŠ” HTTP ê¸°ë°˜ MCP ì„œë²„

```json
{
  "mcpServers": {
    "httpServerWithAuth": {
      "httpUrl": "http://localhost:3000/mcp",
      "headers": {
        "Authorization": "Bearer your-api-token",
        "X-Custom-Header": "custom-value",
        "Content-Type": "application/json"
      },
      "timeout": 5000
    }
  }
}
```

#### ë„êµ¬ í•„í„°ë§ì´ ìˆëŠ” MCP ì„œë²„

```json
{
  "mcpServers": {
    "filteredServer": {
      "command": "python",
      "args": ["-m", "my_mcp_server"],
      "includeTools": ["safe_tool", "file_reader", "data_processor"],
      // "excludeTools": ["dangerous_tool", "file_deleter"],
      "timeout": 30000
    }
  }
}
```

### SA ê°€ì¥ì´ ìˆëŠ” SSE MCP ì„œë²„

```json
{
  "mcpServers": {
    "myIapProtectedServer": {
      "url": "https://my-iap-service.run.app/sse",
      "authProviderType": "service_account_impersonation",
      "targetAudience": "YOUR_IAP_CLIENT_ID.apps.googleusercontent.com",
      "targetServiceAccount": "your-sa@your-project.iam.gserviceaccount.com"
    }
  }
}
```

## ë°œê²¬ í”„ë¡œì„¸ìŠ¤ ì‹¬ì¸µ ë¶„ì„

Gemini CLIê°€ ì‹œì‘ë˜ë©´ ë‹¤ìŒì˜ ìƒì„¸í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ MCP ì„œë²„ ë°œê²¬ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

### 1. ì„œë²„ ë°˜ë³µ ë° ì—°ê²°

`mcpServers`ì— êµ¬ì„±ëœ ê° ì„œë²„ì— ëŒ€í•´:

1. **ìƒíƒœ ì¶”ì  ì‹œì‘:** ì„œë²„ ìƒíƒœê°€ `CONNECTING`ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
2. **ì „ì†¡ ì„ íƒ:** êµ¬ì„± ì†ì„±ì— ë”°ë¦„:
   - `httpUrl` â†’ `StreamableHTTPClientTransport`
   - `url` â†’ `SSEClientTransport`
   - `command` â†’ `StdioClientTransport`
3. **ì—°ê²° ìˆ˜ë¦½:** MCP í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì„±ëœ íƒ€ì„ì•„ì›ƒ ë‚´ì— ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤.
4. **ì˜¤ë¥˜ ì²˜ë¦¬:** ì—°ê²° ì‹¤íŒ¨ ì‹œ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê³  ì„œë²„ ìƒíƒœë¥¼ `DISCONNECTED`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### 2. ë„êµ¬ ë°œê²¬

ì—°ê²° ì„±ê³µ ì‹œ:

1. **ë„êµ¬ ë‚˜ì—´:** í´ë¼ì´ì–¸íŠ¸ê°€ MCP ì„œë²„ì˜ ë„êµ¬ ë‚˜ì—´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
2. **ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬:** ê° ë„êµ¬ì˜ í•¨ìˆ˜ ì„ ì–¸ì— ëŒ€í•œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
3. **ë„êµ¬ í•„í„°ë§:** `includeTools` ë° `excludeTools` êµ¬ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ë„êµ¬ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤.
4. **ì´ë¦„ ìœ„ìƒ ì²˜ë¦¬:** Gemini API ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ë„ë¡ ë„êµ¬ ì´ë¦„ì„ ì •ë¦¬í•©ë‹ˆë‹¤:
   - ì˜ëª»ëœ ë¬¸ì(ë¹„ ì˜ìˆ«ì, ë°‘ì¤„, ì , í•˜ì´í”ˆ)ëŠ” ë°‘ì¤„ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.
   - 63ìë¥¼ ì´ˆê³¼í•˜ëŠ” ì´ë¦„ì€ ì¤‘ê°„ ëŒ€ì²´(`___`)ë¡œ ì˜ë¦½ë‹ˆë‹¤.

### 3. ì¶©ëŒ í•´ê²°

ì—¬ëŸ¬ ì„œë²„ê°€ ë™ì¼í•œ ì´ë¦„ì˜ ë„êµ¬ë¥¼ ë…¸ì¶œí•  ë•Œ:

1. **ì²« ë²ˆì§¸ ë“±ë¡ ìš°ì„ :** ë„êµ¬ ì´ë¦„ì„ ë“±ë¡í•œ ì²« ë²ˆì§¸ ì„œë²„ê°€ ì ‘ë‘ì‚¬ ì—†ëŠ” ì´ë¦„ì„ ê°€ì ¸ê°‘ë‹ˆë‹¤.
2. **ìë™ ì ‘ë‘ì‚¬:** í›„ì† ì„œë²„ëŠ” ì ‘ë‘ì‚¬ê°€ ë¶™ì€ ì´ë¦„ì„ ë°›ìŠµë‹ˆë‹¤: `serverName__toolName`
3. **ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì¶”ì :** ë„êµ¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” ì„œë²„ ì´ë¦„ê³¼ í•´ë‹¹ ë„êµ¬ ê°„ì˜ ë§¤í•‘ì„ ìœ ì§€í•©ë‹ˆë‹¤.

### 4. ìŠ¤í‚¤ë§ˆ ì²˜ë¦¬

ë„êµ¬ ë§¤ê°œë³€ìˆ˜ ìŠ¤í‚¤ë§ˆëŠ” Gemini API í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ„ìƒ ì²˜ë¦¬ë¥¼ ê±°ì¹©ë‹ˆë‹¤:

- **`$schema` ì†ì„±** ì œê±°
- **`additionalProperties`** ì œê±°
- **`anyOf`ì™€ `default`**ê°€ í•¨ê»˜ ìˆëŠ” ê²½ìš° ê¸°ë³¸ê°’ ì œê±° (Vertex AI í˜¸í™˜ì„±)
- ì¤‘ì²©ëœ ìŠ¤í‚¤ë§ˆì— **ì¬ê·€ì  ì²˜ë¦¬** ì ìš©

### 5. ì—°ê²° ê´€ë¦¬

ë°œê²¬ í›„:

- **ì§€ì†ì ì¸ ì—°ê²°:** ë„êµ¬ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡í•œ ì„œë²„ëŠ” ì—°ê²°ì„ ìœ ì§€í•©ë‹ˆë‹¤.
- **ì •ë¦¬:** ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” ì„œë²„ëŠ” ì—°ê²°ì´ ë‹«í™ë‹ˆë‹¤.
- **ìƒíƒœ ì—…ë°ì´íŠ¸:** ìµœì¢… ì„œë²„ ìƒíƒœê°€ `CONNECTED` ë˜ëŠ” `DISCONNECTED`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.

## ë„êµ¬ ì‹¤í–‰ íë¦„

Gemini ëª¨ë¸ì´ MCP ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í•˜ë©´ ë‹¤ìŒ ì‹¤í–‰ íë¦„ì´ ë°œìƒí•©ë‹ˆë‹¤:

### 1. ë„êµ¬ í˜¸ì¶œ

ëª¨ë¸ì€ ë‹¤ìŒê³¼ í•¨ê»˜ `FunctionCall`ì„ ìƒì„±í•©ë‹ˆë‹¤:

- **ë„êµ¬ ì´ë¦„:** ë“±ë¡ëœ ì´ë¦„ (ì ì¬ì ìœ¼ë¡œ ì ‘ë‘ì‚¬ í¬í•¨)
- **ì¸ìˆ˜:** ë„êµ¬ì˜ ë§¤ê°œë³€ìˆ˜ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ëŠ” JSON ê°ì²´

### 2. í™•ì¸ í”„ë¡œì„¸ìŠ¤

ê° `DiscoveredMCPTool`ì€ ì •êµí•œ í™•ì¸ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤:

#### ì‹ ë¢° ê¸°ë°˜ ìš°íšŒ

```typescript
if (this.trust) {
  return false; // í™•ì¸ í•„ìš” ì—†ìŒ
}
```

#### ë™ì  í—ˆìš© ëª©ë¡

ì‹œìŠ¤í…œì€ ë‹¤ìŒì— ëŒ€í•œ ë‚´ë¶€ í—ˆìš© ëª©ë¡ì„ ìœ ì§€í•©ë‹ˆë‹¤:

- **ì„œë²„ ìˆ˜ì¤€:** `serverName` â†’ ì´ ì„œë²„ì˜ ëª¨ë“  ë„êµ¬ë¥¼ ì‹ ë¢°í•¨
- **ë„êµ¬ ìˆ˜ì¤€:** `serverName.toolName` â†’ ì´ íŠ¹ì • ë„êµ¬ë¥¼ ì‹ ë¢°í•¨

#### ì‚¬ìš©ì ì„ íƒ ì²˜ë¦¬

í™•ì¸ì´ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ìê°€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **í•œ ë²ˆ ì§„í–‰:** ì´ë²ˆë§Œ ì‹¤í–‰
- **ì´ ë„êµ¬ í•­ìƒ í—ˆìš©:** ë„êµ¬ ìˆ˜ì¤€ í—ˆìš© ëª©ë¡ì— ì¶”ê°€
- **ì´ ì„œë²„ í•­ìƒ í—ˆìš©:** ì„œë²„ ìˆ˜ì¤€ í—ˆìš© ëª©ë¡ì— ì¶”ê°€
- **ì·¨ì†Œ:** ì‹¤í–‰ ì¤‘ë‹¨

### 3. ì‹¤í–‰

í™•ì¸(ë˜ëŠ” ì‹ ë¢° ìš°íšŒ) ì‹œ:

1. **ë§¤ê°œë³€ìˆ˜ ì¤€ë¹„:** ì¸ìˆ˜ê°€ ë„êµ¬ì˜ ìŠ¤í‚¤ë§ˆì— ëŒ€í•´ ìœ íš¨í•œì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.
2. **MCP í˜¸ì¶œ:** ê¸°ë³¸ `CallableTool`ì´ ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤:

   ```typescript
   const functionCalls = [
     {
       name: this.serverToolName, // ì›ë³¸ ì„œë²„ ë„êµ¬ ì´ë¦„
       args: params,
     },
   ];
   ```

3. **ì‘ë‹µ ì²˜ë¦¬:** ê²°ê³¼ëŠ” LLM ì»¨í…ìŠ¤íŠ¸ì™€ ì‚¬ìš©ì í‘œì‹œ ëª¨ë‘ë¥¼ ìœ„í•´ í¬ë§·íŒ…ë©ë‹ˆë‹¤.

### 4. ì‘ë‹µ ì²˜ë¦¬

ì‹¤í–‰ ê²°ê³¼ëŠ” ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:

- **`llmContent`:** ì–¸ì–´ ëª¨ë¸ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì›ì‹œ ì‘ë‹µ ë¶€ë¶„
- **`returnDisplay`:** ì‚¬ìš©ì í‘œì‹œë¥¼ ìœ„í•œ í˜•ì‹ì´ ì§€ì •ëœ ì¶œë ¥ (ì¢…ì¢… ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ë‚´ì˜ JSON)

## MCP ì„œë²„ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•

### `/mcp` ëª…ë ¹ ì‚¬ìš©

`/mcp` ëª…ë ¹ì€ MCP ì„œë²„ ì„¤ì •ì— ëŒ€í•œ í¬ê´„ì ì¸ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```bash
/mcp
```

ì´ëŠ” ë‹¤ìŒì„ í‘œì‹œí•©ë‹ˆë‹¤:

- **ì„œë²„ ëª©ë¡:** êµ¬ì„±ëœ ëª¨ë“  MCP ì„œë²„
- **ì—°ê²° ìƒíƒœ:** `CONNECTED`, `CONNECTING`, ë˜ëŠ” `DISCONNECTED`
- **ì„œë²„ ì„¸ë¶€ ì •ë³´:** êµ¬ì„± ìš”ì•½ (ë¯¼ê°í•œ ë°ì´í„° ì œì™¸)
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬:** ê° ì„œë²„ì˜ ë„êµ¬ ëª©ë¡ ë° ì„¤ëª…
- **ë°œê²¬ ìƒíƒœ:** ì „ì²´ ë°œê²¬ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ

### `/mcp` ì¶œë ¥ ì˜ˆì‹œ

```
MCP Servers Status:

ğŸ“¡ pythonTools (CONNECTED)
  Command: python -m my_mcp_server --port 8080
  Working Directory: ./mcp-servers/python
  Timeout: 15000ms
  Tools: calculate_sum, file_analyzer, data_processor

ğŸ”Œ nodeServer (DISCONNECTED)
  Command: node dist/server.js --verbose
  Error: Connection refused

ğŸ³ dockerizedServer (CONNECTED)
  Command: docker run -i --rm -e API_KEY my-mcp-server:latest
  Tools: docker__deploy, docker__status

Discovery State: COMPLETED
```

### ë„êµ¬ ì‚¬ìš©ë²•

ë°œê²¬ëœ MCP ë„êµ¬ëŠ” ê¸°ë³¸ ì œê³µ ë„êµ¬ì²˜ëŸ¼ Gemini ëª¨ë¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë¸ì€ ìë™ìœ¼ë¡œ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. ìš”ì²­ì— ë”°ë¼ **ì ì ˆí•œ ë„êµ¬ ì„ íƒ**
2. **í™•ì¸ ëŒ€í™” ìƒì í‘œì‹œ** (ì„œë²„ê°€ ì‹ ë¢°ë˜ì§€ ì•Šì€ ê²½ìš°)
3. ì ì ˆí•œ ë§¤ê°œë³€ìˆ˜ë¡œ **ë„êµ¬ ì‹¤í–‰**
4. ì‚¬ìš©ì ì¹œí™”ì ì¸ í˜•ì‹ìœ¼ë¡œ **ê²°ê³¼ í‘œì‹œ**

## ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ë¬¸ì œ í•´ê²°

### ì—°ê²° ìƒíƒœ

MCP í†µí•©ì€ ì—¬ëŸ¬ ìƒíƒœë¥¼ ì¶”ì í•©ë‹ˆë‹¤:

#### ì„œë²„ ìƒíƒœ (`MCPServerStatus`)

- **`DISCONNECTED`:** ì„œë²„ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì˜¤ë¥˜ê°€ ìˆìŒ
- **`CONNECTING`:** ì—°ê²° ì‹œë„ ì¤‘
- **`CONNECTED`:** ì„œë²„ê°€ ì—°ê²°ë˜ì–´ ì¤€ë¹„ë¨

#### ë°œê²¬ ìƒíƒœ (`MCPDiscoveryState`)

- **`NOT_STARTED`:** ë°œê²¬ì´ ì‹œì‘ë˜ì§€ ì•ŠìŒ
- **`IN_PROGRESS`:** í˜„ì¬ ì„œë²„ ë°œê²¬ ì¤‘
- **`COMPLETED`:** ë°œê²¬ ì™„ë£Œ (ì˜¤ë¥˜ ìœ ë¬´ ê´€ê³„ì—†ìŒ)

### ì¼ë°˜ì ì¸ ë¬¸ì œ ë° í•´ê²° ë°©ë²•

#### ì„œë²„ê°€ ì—°ê²°ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:** ì„œë²„ ìƒíƒœê°€ `DISCONNECTED`ë¡œ í‘œì‹œë¨

**ë¬¸ì œ í•´ê²°:**

1. **êµ¬ì„± í™•ì¸:** `command`, `args`, `cwd`ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.
2. **ìˆ˜ë™ í…ŒìŠ¤íŠ¸:** ì„œë²„ ëª…ë ¹ì„ ì§ì ‘ ì‹¤í–‰í•˜ì—¬ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
3. **ì¢…ì†ì„± í™•ì¸:** í•„ìš”í•œ ëª¨ë“  íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
4. **ë¡œê·¸ ê²€í† :** CLI ì¶œë ¥ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì°¾ìœ¼ì„¸ìš”.
5. **ê¶Œí•œ í™•ì¸:** CLIê°€ ì„œë²„ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

#### ë„êµ¬ê°€ ë°œê²¬ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:** ì„œë²„ëŠ” ì—°ê²°ë˜ì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ê°€ ì—†ìŒ

**ë¬¸ì œ í•´ê²°:**

1. **ë„êµ¬ ë“±ë¡ í™•ì¸:** ì„œë²„ê°€ ì‹¤ì œë¡œ ë„êµ¬ë¥¼ ë“±ë¡í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
2. **MCP í”„ë¡œí† ì½œ í™•ì¸:** ì„œë²„ê°€ MCP ë„êµ¬ ëª©ë¡ì„ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
3. **ì„œë²„ ë¡œê·¸ ê²€í† :** ì„œë²„ ì¸¡ ì˜¤ë¥˜ì— ëŒ€í•´ stderr ì¶œë ¥ì„ í™•ì¸í•˜ì„¸ìš”.
4. **ë„êµ¬ ë‚˜ì—´ í…ŒìŠ¤íŠ¸:** ì„œë²„ì˜ ë„êµ¬ ë°œê²¬ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.

#### ë„êµ¬ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:** ë„êµ¬ê°€ ë°œê²¬ë˜ì§€ë§Œ ì‹¤í–‰ ì¤‘ ì‹¤íŒ¨í•¨

**ë¬¸ì œ í•´ê²°:**

1. **ë§¤ê°œë³€ìˆ˜ ìœ íš¨ì„± ê²€ì‚¬:** ë„êµ¬ê°€ ì˜ˆìƒë˜ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ í—ˆìš©í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
2. **ìŠ¤í‚¤ë§ˆ í˜¸í™˜ì„±:** ì…ë ¥ ìŠ¤í‚¤ë§ˆê°€ ìœ íš¨í•œ JSON ìŠ¤í‚¤ë§ˆì¸ì§€ í™•ì¸í•˜ì„¸ìš”.
3. **ì˜¤ë¥˜ ì²˜ë¦¬:** ë„êµ¬ê°€ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
4. **íƒ€ì„ì•„ì›ƒ ë¬¸ì œ:** `timeout` ì„¤ì •ì„ ëŠ˜ë ¤ë³´ì„¸ìš”.

#### ìƒŒë“œë°•ìŠ¤ í˜¸í™˜ì„±

**ì¦ìƒ:** ìƒŒë“œë°•ì‹±ì´ í™œì„±í™”ë˜ì—ˆì„ ë•Œ MCP ì„œë²„ê°€ ì‹¤íŒ¨í•¨

**í•´ê²° ë°©ë²•:**

1. **Docker ê¸°ë°˜ ì„œë²„:** ëª¨ë“  ì¢…ì†ì„±ì„ í¬í•¨í•˜ëŠ” Docker ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
2. **ê²½ë¡œ ì ‘ê·¼ì„±:** ì„œë²„ ì‹¤í–‰ íŒŒì¼ì´ ìƒŒë“œë°•ìŠ¤ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ì„¸ìš”.
3. **ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤:** í•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í—ˆìš©í•˜ë„ë¡ ìƒŒë“œë°•ìŠ¤ë¥¼ êµ¬ì„±í•˜ì„¸ìš”.
4. **í™˜ê²½ ë³€ìˆ˜:** í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ê°€ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

### ë””ë²„ê¹… íŒ

1. **ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”:** ìì„¸í•œ ì¶œë ¥ì„ ìœ„í•´ `--debug`ë¡œ CLIë¥¼ ì‹¤í–‰í•˜ì„¸ìš” (ëŒ€í™”í˜• ëª¨ë“œì—ì„œ ë””ë²„ê·¸ ì½˜ì†”ì„ ì—´ë ¤ë©´ F12 ì‚¬ìš©).
2. **stderr í™•ì¸:** MCP ì„œë²„ stderrê°€ ìº¡ì²˜ë˜ì–´ ê¸°ë¡ë©ë‹ˆë‹¤ (INFO ë©”ì‹œì§€ëŠ” í•„í„°ë§ë¨).
3. **í…ŒìŠ¤íŠ¸ ê²©ë¦¬:** í†µí•©í•˜ê¸° ì „ì— MCP ì„œë²„ë¥¼ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.
4. **ì ì§„ì  ì„¤ì •:** ë³µì¡í•œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ì „ì— ê°„ë‹¨í•œ ë„êµ¬ë¡œ ì‹œì‘í•˜ì„¸ìš”.
5. **`/mcp` ìì£¼ ì‚¬ìš©:** ê°œë°œ ì¤‘ ì„œë²„ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.

## ì¤‘ìš” ì‚¬í•­

### ë³´ì•ˆ ê³ ë ¤ ì‚¬í•­

- **ì‹ ë¢° ì„¤ì •:** `trust` ì˜µì…˜ì€ ëª¨ë“  í™•ì¸ ëŒ€í™” ìƒìë¥¼ ìš°íšŒí•©ë‹ˆë‹¤. ì™„ì „íˆ ì œì–´í•  ìˆ˜ ìˆëŠ” ì„œë²„ì— ëŒ€í•´ì„œë§Œ ì£¼ì˜í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”.
- **ì•¡ì„¸ìŠ¤ í† í°:** API í‚¤ë‚˜ í† í°ì´ í¬í•¨ëœ í™˜ê²½ ë³€ìˆ˜ë¥¼ êµ¬ì„±í•  ë•Œ ë³´ì•ˆì— ìœ ì˜í•˜ì„¸ìš”.
- **í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì •(Redaction):** ê¸°ë³¸ì ìœ¼ë¡œ Gemini CLIëŠ” `stdio` ì „ì†¡ì„ ì‚¬ìš©í•˜ì—¬ MCP ì„œë²„ë¥¼ ìƒì„±í•  ë•Œ ë¯¼ê°í•œ í™˜ê²½ ë³€ìˆ˜(`GEMINI_API_KEY`, `GOOGLE_API_KEY`, ê·¸ë¦¬ê³  `*TOKEN*`, `*SECRET*`, `*PASSWORD*`ì™€ ê°™ì€ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ë³€ìˆ˜)ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤. ì´ëŠ” ìê²© ì¦ëª…ì´ ì œ3ì ì„œë²„ì— ì˜ë„ì¹˜ ì•Šê²Œ ë…¸ì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
- **ëª…ì‹œì  í™˜ê²½ ë³€ìˆ˜:** íŠ¹ì • í™˜ê²½ ë³€ìˆ˜ë¥¼ MCP ì„œë²„ì— ì „ë‹¬í•´ì•¼ í•˜ëŠ” ê²½ìš°, `settings.json`ì˜ ì„œë²„ êµ¬ì„±ì— ìˆëŠ” `env` ì†ì„±ì— ëª…ì‹œì ìœ¼ë¡œ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **ìƒŒë“œë°•ìŠ¤ í˜¸í™˜ì„±:** ìƒŒë“œë°•ì‹± ì‚¬ìš© ì‹œ, MCP ì„œë²„ê°€ ìƒŒë“œë°•ìŠ¤ í™˜ê²½ ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ì„¸ìš”.
- **ê°œì¸ ë°ì´í„°:** ê´‘ë²”ìœ„í•œ ë²”ìœ„ì˜ ê°œì¸ ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ë©´ ì €ì¥ì†Œ ê°„ ì •ë³´ ìœ ì¶œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì„œë²„:** ì‹ ë¢°í•  ìˆ˜ ì—†ê±°ë‚˜ ì œ3ì ì†ŒìŠ¤ì—ì„œ MCP ì„œë²„ë¥¼ ì¶”ê°€í•  ë•Œ ë§¤ìš° ì£¼ì˜í•˜ì„¸ìš”. ì•…ì„± ì„œë²„ëŠ” ë…¸ì¶œëœ ë„êµ¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìœ ì¶œí•˜ê±°ë‚˜ ìŠ¹ì¸ë˜ì§€ ì•Šì€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ê³  ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„±ëŠ¥ ë° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

- **ì—°ê²° ì§€ì†ì„±:** CLIëŠ” ë„êµ¬ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡í•œ ì„œë²„ì— ëŒ€í•´ ì§€ì†ì ì¸ ì—°ê²°ì„ ìœ ì§€í•©ë‹ˆë‹¤.
- **ìë™ ì •ë¦¬:** ë„êµ¬ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” ì„œë²„ì— ëŒ€í•œ ì—°ê²°ì€ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤.
- **íƒ€ì„ì•„ì›ƒ ê´€ë¦¬:** ì„œë²„ì˜ ì‘ë‹µ íŠ¹ì„±ì— ë”°ë¼ ì ì ˆí•œ íƒ€ì„ì•„ì›ƒì„ êµ¬ì„±í•˜ì„¸ìš”.
- **ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§:** MCP ì„œë²„ëŠ” ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ë©° ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ì†Œë¹„í•©ë‹ˆë‹¤.

### ìŠ¤í‚¤ë§ˆ í˜¸í™˜ì„±

- **ì†ì„± ì œê±°:** ì‹œìŠ¤í…œì€ Gemini API í˜¸í™˜ì„±ì„ ìœ„í•´ íŠ¹ì • ìŠ¤í‚¤ë§ˆ ì†ì„±(`$schema`, `additionalProperties`)ì„ ìë™ìœ¼ë¡œ ì œê±°í•©ë‹ˆë‹¤.
- **ì´ë¦„ ìœ„ìƒ ì²˜ë¦¬:** ë„êµ¬ ì´ë¦„ì€ API ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ë„ë¡ ìë™ìœ¼ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤.
- **ì¶©ëŒ í•´ê²°:** ì„œë²„ ê°„ì˜ ë„êµ¬ ì´ë¦„ ì¶©ëŒì€ ìë™ ì ‘ë‘ì‚¬ë¥¼ í†µí•´ í•´ê²°ë©ë‹ˆë‹¤.

ì´ í¬ê´„ì ì¸ í†µí•©ì„ í†µí•´ MCP ì„œë²„ëŠ” ë³´ì•ˆ, ì‹ ë¢°ì„± ë° ì‚¬ìš© í¸ì˜ì„±ì„ ìœ ì§€í•˜ë©´ì„œ Gemini CLIì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ” ê°•ë ¥í•œ ë°©ë²•ì´ ë©ë‹ˆë‹¤.

## ë„êµ¬ì—ì„œ í’ë¶€í•œ ì½˜í…ì¸  ë°˜í™˜

MCP ë„êµ¬ëŠ” ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ ë°˜í™˜ì—ë§Œ êµ­í•œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨ì¼ ë„êµ¬ ì‘ë‹µìœ¼ë¡œ í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, ì˜¤ë””ì˜¤ ë° ê¸°íƒ€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ í¬í•¨í•œ í’ë¶€í•œ ë©€í‹° íŒŒíŠ¸ ì½˜í…ì¸ ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í•œ ë²ˆì˜ í„´ìœ¼ë¡œ ëª¨ë¸ì— ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë„êµ¬ì—ì„œ ë°˜í™˜ëœ ëª¨ë“  ë°ì´í„°ëŠ” ì²˜ë¦¬ë˜ì–´ ëª¨ë¸ì˜ ë‹¤ìŒ ìƒì„±ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ì†¡ë˜ë¯€ë¡œ, ëª¨ë¸ì´ ì œê³µëœ ì •ë³´ë¥¼ ì¶”ë¡ í•˜ê±°ë‚˜ ìš”ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‘ë™ ë°©ì‹

í’ë¶€í•œ ì½˜í…ì¸ ë¥¼ ë°˜í™˜í•˜ë ¤ë©´ ë„êµ¬ì˜ ì‘ë‹µì´
[`CallToolResult`](https://modelcontextprotocol.io/specification/2025-06-18/server/tools#tool-result)ì— ëŒ€í•œ MCP ì‚¬ì–‘ì„ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.
ê²°ê³¼ì˜ `content` í•„ë“œëŠ” `ContentBlock` ê°ì²´ì˜ ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
Gemini CLIëŠ” ì´ ë°°ì—´ì„ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ì—¬ í…ìŠ¤íŠ¸ì™€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•˜ê³  ëª¨ë¸ì„ ìœ„í•´ íŒ¨í‚¤ì§•í•©ë‹ˆë‹¤.

`content` ë°°ì—´ì—ì„œ ë‹¤ì–‘í•œ ì½˜í…ì¸  ë¸”ë¡ ìœ í˜•ì„ í˜¼í•©í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì§€ì›ë˜ëŠ” ë¸”ë¡ ìœ í˜•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- `text`
- `image`
- `audio`
- `resource` (ì„ë² ë””ë“œ ì½˜í…ì¸ )
- `resource_link`

### ì˜ˆì‹œ: í…ìŠ¤íŠ¸ ë° ì´ë¯¸ì§€ ë°˜í™˜

ë‹¤ìŒì€ í…ìŠ¤íŠ¸ ì„¤ëª…ê³¼ ì´ë¯¸ì§€ë¥¼ ëª¨ë‘ ë°˜í™˜í•˜ëŠ” MCP ë„êµ¬ì˜ ìœ íš¨í•œ JSON ì‘ë‹µ ì˜ˆì‹œì…ë‹ˆë‹¤:

```json
{
  "content": [
    {
      "type": "text",
      "text": "Here is the logo you requested."
    },
    {
      "type": "image",
      "data": "BASE64_ENCODED_IMAGE_DATA_HERE",
      "mimeType": "image/png"
    },
    {
      "type": "text",
      "text": "The logo was created in 2025."
    }
  ]
}
```

Gemini CLIê°€ ì´ ì‘ë‹µì„ ë°›ìœ¼ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1.  ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ì—¬ ëª¨ë¸ì„ ìœ„í•œ ë‹¨ì¼ `functionResponse` ë¶€ë¶„ìœ¼ë¡œ ê²°í•©í•©ë‹ˆë‹¤.
2.  ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë³„ë„ì˜ `inlineData` ë¶€ë¶„ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
3.  í…ìŠ¤íŠ¸ì™€ ì´ë¯¸ì§€ê°€ ëª¨ë‘ ìˆ˜ì‹ ë˜ì—ˆìŒì„ ë‚˜íƒ€ë‚´ëŠ” ê¹”ë”í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ì¸ ìš”ì•½ì„ CLIì— ì œê³µí•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ Gemini ëª¨ë¸ì— í’ë¶€í•œ ë©€í‹°ëª¨ë‹¬ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•  ìˆ˜ ìˆëŠ” ì •êµí•œ ë„êµ¬ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ìŠ¬ë˜ì‹œ ëª…ë ¹ìœ¼ë¡œì„œì˜ MCP í”„ë¡¬í”„íŠ¸

ë„êµ¬ ì™¸ì—ë„ MCP ì„œë²„ëŠ” Gemini CLI ë‚´ì—ì„œ ìŠ¬ë˜ì‹œ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë¯¸ë¦¬ ì •ì˜ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì´ë¦„ìœ¼ë¡œ ì‰½ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ì¼ë°˜ì ì´ê±°ë‚˜ ë³µì¡í•œ ì¿¼ë¦¬ì— ëŒ€í•œ ë°”ë¡œ ê°€ê¸°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„œë²„ì— í”„ë¡¬í”„íŠ¸ ì •ì˜í•˜ê¸°

ë‹¤ìŒì€ í”„ë¡¬í”„íŠ¸ë¥¼ ì •ì˜í•˜ëŠ” stdio MCP ì„œë²„ì˜ ê°„ë‹¨í•œ ì˜ˆì…ë‹ˆë‹¤:

```ts
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { z } from 'zod';

const server = new McpServer({
  name: 'prompt-server',
  version: '1.0.0',
});

server.registerPrompt(
  'poem-writer',
  {
    title: 'Poem Writer',
    description: 'Write a nice haiku',
    argsSchema: { title: z.string(), mood: z.string().optional() },
  },
  ({ title, mood }) => ({
    messages: [
      {
        role: 'user',
        content: {
          type: 'text',
          text: `Write a haiku${mood ? ` with the mood ${mood}` : ''} called ${title}. Note that a haiku is 5 syllables followed by 7 syllables followed by 5 syllables `,
        },
      },
    ],
  }),
);

const transport = new StdioServerTransport();
await server.connect(transport);
```

ì´ê²ƒì€ `settings.json`ì˜ `mcpServers` ì•„ë˜ì— ë‹¤ìŒê³¼ ê°™ì´ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "mcpServers": {
    "nodeServer": {
      "command": "node",
      "args": ["filename.ts"]
    }
  }
}
```

### í”„ë¡¬í”„íŠ¸ í˜¸ì¶œ

í”„ë¡¬í”„íŠ¸ê°€ ë°œê²¬ë˜ë©´ ì´ë¦„ì„ ìŠ¬ë˜ì‹œ ëª…ë ¹ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CLIëŠ” ìë™ìœ¼ë¡œ ì¸ìˆ˜ íŒŒì‹±ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```bash
/poem-writer --title="Gemini CLI" --mood="reverent"
```

ë˜ëŠ” ìœ„ì¹˜ ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬:

```bash
/poem-writer "Gemini CLI" reverent
```

ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ Gemini CLIëŠ” ì œê³µëœ ì¸ìˆ˜ì™€ í•¨ê»˜ MCP ì„œë²„ì—ì„œ `prompts/get` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì„œë²„ëŠ” í…œí”Œë¦¿ì— ì¸ìˆ˜ë¥¼ ëŒ€ì…í•˜ê³  ìµœì¢… í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•  ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ CLIê°€ ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰ì„ ìœ„í•´ ëª¨ë¸ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ì¸ ì›Œí¬í”Œë¡œë¥¼ ìë™í™”í•˜ê³  ê³µìœ í•˜ëŠ” í¸ë¦¬í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

## `gemini mcp`ë¡œ MCP ì„œë²„ ê´€ë¦¬

`settings.json` íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ í¸ì§‘í•˜ì—¬ ì–¸ì œë“ ì§€ MCP ì„œë²„ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆì§€ë§Œ, Gemini CLIëŠ” í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì„œë²„ êµ¬ì„±ì„ ê´€ë¦¬í•˜ëŠ” í¸ë¦¬í•œ ëª…ë ¹ ì„¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ëª…ë ¹ë“¤ì€ JSON íŒŒì¼ì„ ì§ì ‘ í¸ì§‘í•  í•„ìš” ì—†ì´ MCP ì„œë²„ë¥¼ ì¶”ê°€, ë‚˜ì—´ ë° ì œê±°í•˜ëŠ” ê³¼ì •ì„ ê°„ì†Œí™”í•©ë‹ˆë‹¤.

### ì„œë²„ ì¶”ê°€ (`gemini mcp add`)

`add` ëª…ë ¹ì€ `settings.json`ì— ìƒˆ MCP ì„œë²„ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤. ë²”ìœ„(`-s, --scope`)ì— ë”°ë¼ ì‚¬ìš©ì êµ¬ì„± `~/.gemini/settings.json` ë˜ëŠ” í”„ë¡œì íŠ¸ êµ¬ì„± `.gemini/settings.json` íŒŒì¼ì— ì¶”ê°€ë©ë‹ˆë‹¤.

**ëª…ë ¹:**

```bash
gemini mcp add [options] <name> <commandOrUrl> [args...]
```

- `<name>`: ì„œë²„ì˜ ê³ ìœ  ì´ë¦„ì…ë‹ˆë‹¤.
- `<commandOrUrl>`: ì‹¤í–‰í•  ëª…ë ¹(`stdio`ìš©) ë˜ëŠ” URL(`http`/`sse`ìš©)ì…ë‹ˆë‹¤.
- `[args...]`: `stdio` ëª…ë ¹ì— ëŒ€í•œ ì„ íƒì  ì¸ìˆ˜ì…ë‹ˆë‹¤.

**ì˜µì…˜ (í”Œë˜ê·¸):**

- `-s, --scope`: êµ¬ì„± ë²”ìœ„ (user ë˜ëŠ” project). [ê¸°ë³¸ê°’: "project"]
- `-t, --transport`: ì „ì†¡ ìœ í˜• (stdio, sse, http). [ê¸°ë³¸ê°’: "stdio"]
- `-e, --env`: í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ì˜ˆ: -e KEY=value).
- `-H, --header`: SSE ë° HTTP ì „ì†¡ì„ ìœ„í•œ HTTP í—¤ë” ì„¤ì • (ì˜ˆ: -H "X-Api-Key: abc123" -H "Authorization: Bearer abc123").
- `--timeout`: ì—°ê²° íƒ€ì„ì•„ì›ƒ(ë°€ë¦¬ì´ˆ) ì„¤ì •.
- `--trust`: ì„œë²„ ì‹ ë¢° (ëª¨ë“  ë„êµ¬ í˜¸ì¶œ í™•ì¸ í”„ë¡¬í”„íŠ¸ ìš°íšŒ).
- `--description`: ì„œë²„ ì„¤ëª… ì„¤ì •.
- `--include-tools`: í¬í•¨í•  ë„êµ¬ì˜ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ëª©ë¡.
- `--exclude-tools`: ì œì™¸í•  ë„êµ¬ì˜ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ëª©ë¡.

#### stdio ì„œë²„ ì¶”ê°€

ë¡œì»¬ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ì „ì†¡ì…ë‹ˆë‹¤.

```bash
# ê¸°ë³¸ êµ¬ë¬¸
gemini mcp add [options] <name> <command> [args...]

# ì˜ˆ: ë¡œì»¬ ì„œë²„ ì¶”ê°€
gemini mcp add -e API_KEY=123 -e DEBUG=true my-stdio-server /path/to/server arg1 arg2 arg3

# ì˜ˆ: ë¡œì»¬ python ì„œë²„ ì¶”ê°€
gemini mcp add python-server python server.py -- --server-arg my-value
```

#### HTTP ì„œë²„ ì¶”ê°€

ìŠ¤íŠ¸ë¦¬ë° ê°€ëŠ¥í•œ HTTP ì „ì†¡ì„ ì‚¬ìš©í•˜ëŠ” ì„œë²„ë¥¼ ìœ„í•œ ì „ì†¡ì…ë‹ˆë‹¤.

```bash
# ê¸°ë³¸ êµ¬ë¬¸
gemini mcp add --transport http <name> <url>

# ì˜ˆ: HTTP ì„œë²„ ì¶”ê°€
gemini mcp add --transport http http-server https://api.example.com/mcp/

# ì˜ˆ: ì¸ì¦ í—¤ë”ê°€ ìˆëŠ” HTTP ì„œë²„ ì¶”ê°€
gemini mcp add --transport http --header "Authorization: Bearer abc123" secure-http https://api.example.com/mcp/
```

#### SSE ì„œë²„ ì¶”ê°€

Server-Sent Events (SSE)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë²„ë¥¼ ìœ„í•œ ì „ì†¡ì…ë‹ˆë‹¤.

```bash
# ê¸°ë³¸ êµ¬ë¬¸
gemini mcp add --transport sse <name> <url>

# ì˜ˆ: SSE ì„œë²„ ì¶”ê°€
gemini mcp add --transport sse sse-server https://api.example.com/sse/

# ì˜ˆ: ì¸ì¦ í—¤ë”ê°€ ìˆëŠ” SSE ì„œë²„ ì¶”ê°€
gemini mcp add --transport sse --header "Authorization: Bearer abc123" secure-sse https://api.example.com/sse/
```

### ì„œë²„ ë‚˜ì—´ (`gemini mcp list`)

í˜„ì¬ êµ¬ì„±ëœ ëª¨ë“  MCP ì„œë²„ë¥¼ ë³´ë ¤ë©´ `list` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì„¸ìš”. ê° ì„œë²„ì˜ ì´ë¦„, êµ¬ì„± ì„¸ë¶€ ì •ë³´ ë° ì—°ê²° ìƒíƒœë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì—ëŠ” í”Œë˜ê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.

**ëª…ë ¹:**

```bash
gemini mcp list
```

**ì¶œë ¥ ì˜ˆì‹œ:**

```sh
âœ“ stdio-server: command: python3 server.py (stdio) - Connected
âœ“ http-server: https://api.example.com/mcp (http) - Connected
âœ— sse-server: https://api.example.com/sse (sse) - Disconnected
```

### ì„œë²„ ì œê±° (`gemini mcp remove`)

êµ¬ì„±ì—ì„œ ì„œë²„ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ì„œë²„ ì´ë¦„ê³¼ í•¨ê»˜ `remove` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì„¸ìš”.

**ëª…ë ¹:**

```bash
gemini mcp remove <name>
```

**ì˜µì…˜ (í”Œë˜ê·¸):**

- `-s, --scope`: êµ¬ì„± ë²”ìœ„ (user ë˜ëŠ” project). [ê¸°ë³¸ê°’: "project"]

**ì˜ˆ:**

```bash
gemini mcp remove my-server
```

ì´ ëª…ë ¹ì€ ë²”ìœ„(`-s, --scope`)ì— ë”°ë¼ ì ì ˆí•œ `settings.json` íŒŒì¼ì˜ `mcpServers` ê°ì²´ì—ì„œ "my-server" í•­ëª©ì„ ì°¾ì•„ ì‚­ì œí•©ë‹ˆë‹¤.

### ì„œë²„ í™œì„±í™”/ë¹„í™œì„±í™” (`gemini mcp enable`, `gemini mcp disable`)

êµ¬ì„±ì„ ì œê±°í•˜ì§€ ì•Šê³  ì¼ì‹œì ìœ¼ë¡œ MCP ì„œë²„ë¥¼ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ì´ì „ì— ë¹„í™œì„±í™”ëœ ì„œë²„ë¥¼ ë‹¤ì‹œ í™œì„±í™”í•©ë‹ˆë‹¤.

**ëª…ë ¹:**

```bash
gemini mcp enable <name> [--session]
gemini mcp disable <name> [--session]
```

**ì˜µì…˜ (í”Œë˜ê·¸):**

- `--session`: ë³€ê²½ ì‚¬í•­ì„ í˜„ì¬ ì„¸ì…˜ì—ë§Œ ì ìš© (íŒŒì¼ì— ì €ì¥ë˜ì§€ ì•ŠìŒ).

ë¹„í™œì„±í™”ëœ ì„œë²„ëŠ” `/mcp` ìƒíƒœì—ì„œ "Disabled"ë¡œ í‘œì‹œë˜ë©° ì—°ê²°ë˜ê±°ë‚˜ ë„êµ¬ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í™œì„±í™” ìƒíƒœëŠ” `~/.gemini/mcp-server-enablement.json`ì— ì €ì¥ë©ë‹ˆë‹¤.

ë™ì¼í•œ ëª…ë ¹ì„ í™œì„± ì„¸ì…˜ ì¤‘ì— ìŠ¬ë˜ì‹œ ëª…ë ¹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `/mcp enable <name>` ë° `/mcp disable <name>`.

## ì§€ì¹¨

Gemini CLIëŠ”
[MCP ì„œë²„ ì§€ì¹¨](https://modelcontextprotocol.io/specification/2025-06-18/schema#initializeresult)ì„
ì§€ì›í•˜ë©°, ì´ëŠ” ì‹œìŠ¤í…œ ì§€ì¹¨ì— ì¶”ê°€ë©ë‹ˆë‹¤.
